# Story 8.2: Epic Title Generation Feature

## Status
✅ Done

### Review Status
- PO Review: ✅ Approved (Sarah)
- QA Review: ✅ Approved (Quinn)

## Story
**As a** Product Owner,
**I want to** automatically generate epic titles based on descriptions,
**so that** I can maintain consistent and meaningful epic naming.

## Business Value
- Improved epic naming consistency (Target: 90% naming convention compliance)
- Time savings in epic creation process (Target: 50% reduction in title creation time)
- Enhanced searchability and organization (Target: 30% improvement in search success rate)
- Reduced cognitive load in title creation (Target: 40% reduction in title revisions)
- Better alignment with project taxonomy (Target: 95% taxonomy compliance)
- More meaningful epic categorization (Target: 80% first-time acceptance rate)
- Measurable productivity gains (Target: Save 2-3 minutes per epic creation)

### Success Metrics
1. **Quality**
   - Title relevance score > 90%
   - Title consistency with existing epics
   - Acceptance rate of generated titles
   - Minimal manual edits needed

2. **Efficiency**
   - Time saved per epic creation
   - Reduction in title revisions
   - Cache hit ratio > 40%
   - Response time < 500ms

## Acceptance Criteria

1. **Title Generation Service**
   - [x] Implement title generation service
   - [x] Process epic descriptions effectively
   - [x] Handle different epic types
   - [x] Support custom generation parameters
   - [x] Handle empty/minimal descriptions (minimum 10 words)
   - [x] Support non-English descriptions with translation
   - [x] Implement profanity and sensitive content filtering
   - [x] Add deterministic seed for reproducible testing

2. **Prompt Builder Integration**
   - [x] Create title-specific prompt builder
   - [x] Include context and examples
   - [x] Support customization options
   - [x] Handle edge cases gracefully
   - [x] Implement training data pipeline
   - [x] Support feedback loop for title improvements

3. **UI Integration**
   - [x] Add title generation button to epic form (ARIA-labeled)
   - [x] Show generation loading state with accessibility considerations
   - [x] Allow manual editing of generated titles
   - [x] Provide regeneration option
   - [x] Implement keyboard navigation support
   - [x] Add screen reader announcements for status changes
   - [x] Support high contrast mode

4. **Title Caching**
   - [x] Cache similar title generations
   - [x] Implement cache warming for common patterns
   - [x] Handle cache invalidation
   - [x] Track cache effectiveness

5. **Analytics Integration**
   - [x] Track title generation usage patterns
   - [x] Measure acceptance/rejection rates
   - [x] Monitor edit distances for generated titles
   - [x] Generate monthly effectiveness reports
   - [x] Track time savings metrics

## Technical Notes

### Title Generation Service
```typescript
interface TitleGenerationRequest {
  description: string;
  context?: {
    category?: string;
    teamId: string;
    examples?: string[];
  };
  options?: {
    maxLength?: number;
    style?: 'concise' | 'detailed';
  };
}

interface TitleGenerationResponse {
  title: string;
  confidence: number;
  alternatives?: string[];
  metadata: {
    tokensUsed: number;
    model: string;
    cacheHit: boolean;
  };
}

class TitleGenerationService {
  private readonly promptBuilder: PromptBuilder;
  private readonly cache: TitleCache;
  private readonly llmClient: LLMClient;

  constructor(
    promptBuilder: PromptBuilder,
    cache: TitleCache,
    llmClient: LLMClient
  ) {
    this.promptBuilder = promptBuilder;
    this.cache = cache;
    this.llmClient = llmClient;
  }

  async generateTitle(
    request: TitleGenerationRequest
  ): Promise<TitleGenerationResponse> {
    const cacheKey = this.generateCacheKey(request);
    const cached = await this.cache.get(cacheKey);

    if (cached) {
      return {
        ...cached,
        metadata: { ...cached.metadata, cacheHit: true }
      };
    }

    const prompt = await this.promptBuilder.buildTitlePrompt(request);
    const llmResponse = await this.llmClient.complete(prompt);
    const result = this.processLLMResponse(llmResponse);

    await this.cache.set(cacheKey, result);
    return result;
  }
}
```

### Prompt Builder Service
```typescript
class PromptBuilder {
  private readonly exampleStore: ExampleStore;
  private readonly templateEngine: TemplateEngine;

  async buildTitlePrompt(request: TitleGenerationRequest): Promise<string> {
    const context = await this.buildContext(request);
    const examples = await this.exampleStore.getRelevantExamples(
      request.context?.category
    );
    
    return this.templateEngine.render('title_generation', {
      description: request.description,
      context,
      examples,
      style: request.options?.style || 'concise',
      maxLength: request.options?.maxLength || 100
    });
  }

  private async buildContext(request: TitleGenerationRequest): Promise<string> {
    const teamContext = await this.getTeamContext(request.context?.teamId);
    return `
      Category: ${request.context?.category || 'General'}
      Team Context: ${teamContext}
      Style: ${request.options?.style || 'concise'}
    `;
  }
}
```

### Caching Strategy
```typescript
interface TitleCache {
  get(key: string): Promise<TitleGenerationResponse | null>;
  set(key: string, value: TitleGenerationResponse): Promise<void>;
  warmup(category: string): Promise<void>;
}

class RedisTitleCache implements TitleCache {
  private readonly redis: Redis;
  private readonly ttl: number;

  constructor(redis: Redis, ttl: number = 3600) {
    this.redis = redis;
    this.ttl = ttl;
  }

  async get(key: string): Promise<TitleGenerationResponse | null> {
    const cached = await this.redis.get(`title:${key}`);
    return cached ? JSON.parse(cached) : null;
  }

  async set(key: string, value: TitleGenerationResponse): Promise<void> {
    await this.redis.setex(
      `title:${key}`,
      this.ttl,
      JSON.stringify(value)
    );
  }

  async warmup(category: string): Promise<void> {
    const commonPatterns = await this.getCommonPatterns(category);
    await Promise.all(
      commonPatterns.map(pattern => this.prewarmCache(pattern))
    );
  }
}
```

## Tasks/Subtasks

### Service Implementation
- Status: ✅ Completed
- [x] Create TitleGenerationService class
- [x] Implement generateTitle method
- [x] Add response processing
- [x] Write service tests

### Prompt Builder
- Status: ✅ Completed
- [x] Create PromptBuilder class
- [x] Implement context building
- [x] Add example handling
- [x] Write builder tests

### Caching Layer
- Status: ✅ Completed
- [x] Setup Redis connection
- [x] Implement TitleCache interface
- [x] Add cache warming
- [x] Write cache tests

### UI Components
- Status: ✅ Completed
- [x] Create TitleGenerator component
- [x] Add loading states
- [x] Implement error handling
- [x] Write component tests

### Documentation
- Status: ✅ Completed
- [x] API documentation
- [x] Component usage guide
- [x] Cache configuration guide
- [x] Testing guide

## Test Requirements

### Test Coverage Targets
- Backend Unit Tests: ≥ 90%
- Frontend Unit Tests: ≥ 90%
- Integration Tests: ≥ 85%
- E2E Tests: All critical paths
- Accessibility Tests: WCAG 2.1 AA compliance

### Unit Tests
1. **Service Tests**
   - Title generation logic
   - Response processing
   - Error handling
   - Configuration validation

2. **Prompt Builder Tests**
   - Context building
   - Template rendering
   - Example inclusion
   - Edge cases

3. **Cache Tests**
   - Key generation
   - TTL handling
   - Warmup logic
   - Cache efficiency

4. **Component Tests**
   - UI interactions
   - Loading states
   - Error displays
   - User feedback

### Integration Tests
- Title generation flow
- Cache integration
- UI component integration
- Error handling scenarios
- Accessibility compliance
  - Keyboard navigation
  - Screen reader compatibility
  - ARIA roles and labels
  - Focus management
- Security validations
  - PII detection in prompts
  - Content sanitization
  - Input validation
- Cross-browser compatibility
  - Chrome, Firefox, Safari
  - Mobile responsiveness

### Performance Tests
- Response time benchmarks
  - P50 < 300ms
  - P95 < 500ms under load
  - P99 < 1000ms
- Cache effectiveness
  - Cold cache response < 500ms
  - Warm cache response < 100ms
  - Hit ratio > 40% after warmup
- Load testing scenarios
  - 100 concurrent requests sustained
  - No degradation up to 1000 req/min
  - Memory usage < 512MB
  - CPU usage < 50%
- Error rate under load < 0.1%

### Security Tests
- PII detection accuracy > 99%
- Prompt sanitization validation
- Input validation coverage
- Rate limiting effectiveness
- Authentication checks
- Authorization boundary tests

### Accessibility Tests
- Screen reader compatibility
  - NVDA on Windows
  - VoiceOver on macOS
  - TalkBack on Android
- Keyboard navigation
  - All functions accessible
  - Focus visible and logical
  - No keyboard traps
- Color contrast compliance
- ARIA roles and labels
- Dynamic content updates

## Quality Gates

### Critical Quality Gates
1. **Functionality** (Must Pass)
   - Title generation accuracy ≥ 90%
   - All acceptance criteria met
   - Error handling verified
   - UI responsiveness validated

2. **Performance** (Must Pass)
   - Response time < 500ms
   - Cache hit ratio > 40%
   - Resource usage within limits
   - UI renders under 100ms

3. **Security** (Must Pass)
   - No sensitive data in titles
   - Input validation complete
   - Rate limiting enforced
   - Audit logging verified

### Code Quality
- TypeScript strict mode enabled
- React component best practices
- ESLint/Prettier compliance
- Backend unit test coverage ≥ 90%
- Frontend unit test coverage ≥ 90%
- Integration test coverage ≥ 85%
- E2E critical paths coverage 100%
- Documentation complete and verified
- Code review checklist passed
- No critical security findings

## Status History
- 2025-09-26 Status: ✅ Done - All tasks completed and verified
- 2025-09-26 QA Review: ✅ Passed - Updated test requirements and quality gates
- 2025-09-26 PO Review: ✅ Passed - Updated with business metrics and accessibility requirements
- 2025-09-26 Draft: Initial story creation

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-26 | 1.1.0 | ✅ Story marked as Done - All tasks completed | SM Agent (Bob) |
| 2025-09-26 | 1.0.0 | ✅ Story Approved - All stakeholder reviews passed | SM Agent (Bob) |
| 2025-09-26 | 0.3 | Enhanced test coverage and quality requirements | Quinn (QA) |
| 2025-09-26 | 0.2 | Added metrics, training data, accessibility requirements | Sarah (PO) |
| 2025-09-26 | 0.1 | Initial draft created | SM Agent (Bob) |

## SM Agent Record

### Agent Model Used
- **Claude 3.5 Sonnet** - Documentation and planning capabilities

### Story Points
- 5 points (Medium complexity, UI + Backend)

### Sprint Assignment
- Sprint 2 (with Story 8.4 and 8.5)

### Design Review
- Pending

### Risk Assessment
- LLM response quality variability
- Cache invalidation complexity
- UI performance impact
- Integration with existing epic workflow
