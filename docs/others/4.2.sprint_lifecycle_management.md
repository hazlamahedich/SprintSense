# Story 4.2: Sprint Lifecycle Management

## Status
Approved

## Story
**As a** Product Owner,
**I want** to manage the lifecycle of a sprint with clear rules,
**so that** I can control the flow of work without causing confusion.

## Acceptance Criteria
1. Prevents overlapping sprint dates. Sprints are considered overlapping if their date ranges intersect (inclusive of start and end dates).
2. "Start Sprint" button is disabled if a sprint is already active.
3. States are limited to `Future`, `Active`, and `Closed`. Valid transitions are `Future` -> `Active` and `Active` -> `Closed`. All other attempted transitions are invalid and should be rejected by the API.
4. UI clearly displays the current state of each sprint.

## Tasks / Subtasks
## Tasks / Subtasks
- [ ] **Backend**
    - [ ] **API:** Create a new `sprints` table migration based on the `Sprint` data model.
        - [ ] Include fields for `id`, `team_id`, `name`, `status`, `start_date`, `end_date`, `goal`.
        - [ ] The `status` field should be an enum with values: `future`, `active`, `closed`.
    - [ ] **API:** Develop API endpoints for sprint management (`/teams/{team_id}/sprints`).
        - [ ] `POST /sprints`: Create a new sprint. Add validation to prevent overlapping sprint dates for the same team.
        - [ ] `PATCH /sprints/{sprint_id}`: Update a sprint's status. Enforce valid state transitions (`Future` -> `Active`, `Active` -> `Closed`).
        - [ ] `GET /sprints`: List all sprints for a team.
    - [ ] **Business Logic:** Implement the state transition logic in the `Backlog & Sprint Service`.
        - [ ] Only one sprint can be `active` at a time per team.
- [ ] **Frontend**
    - [ ] **UI:** Create a new UI view for sprint management.
    - [ ] **UI:** Display the list of sprints with their current status.
    - [ ] **UI:** Implement a "Start Sprint" button.
        - [ ] The button should be disabled if another sprint is already active.
        - [ ] Clicking the button should call the `PATCH /sprints/{sprint_id}` endpoint to update the status to `active`.
    - [ ] **State Management:** Use Zustand to manage the state of sprints in the frontend.
- [ ] **Testing**
    - [ ] **Backend Unit Tests:**
        - [ ] Test that creating a sprint with overlapping dates returns an error.
        - [ ] Test that attempting to start a sprint when another is already active returns an error.
        - [ ] Test valid state transitions (`Future` -> `Active`, `Active` -> `Closed`).
        - [ ] Test that invalid state transitions (e.g., `Future` -> `Closed`) are rejected.
    - [ ] **Frontend Component Tests:**
        - [ ] Test that the "Start Sprint" button is disabled when a sprint is active.
        - [ ] Test that the UI correctly displays the status of each sprint.
    - [ ] **E2E Tests:**
        - [ ] Create an end-to-end test for the entire sprint lifecycle: create, start, and close a sprint.

## Dev Notes
### Data Models
- **Sprint Model:**
    - `id`: UUID
    - `teamId`: FK to Team
    - `name`: string
    - `status`: enum ('future', 'active', 'closed')
    - `startDate`: Date
    - `endDate`: Date
    - `goal`: string
    - [Source: `docs/architecture/4-data-models.md`]

### API Specifications
- **Endpoints:**
    - `POST /teams/{team_id}/sprints`
    - `PATCH /teams/{team_id}/sprints/{sprint_id}`
    - `GET /teams/{team_id}/sprints`
- **Authentication:** Secure, HTTP-only cookies.
- [Source: `docs/architecture/5-api-specification.md`]

### Backend Architecture
- **Pattern:** Modular Monolith with Repository Pattern.
- **Service:** All business logic should be implemented in the `Backlog & Sprint Service`.
- [Source: `docs/architecture/10-backend-architecture.md`, `docs/architecture/6-components.md`]

### Frontend Architecture
- **State Management:** Zustand
- **API Communication:** Dedicated service layer.
- [Source: `docs/architecture/9-frontend-architecture.md`]

### Testing
- **Backend:**
    - Use `pytest`.
    - Test file location: `backend/tests/`.
    - Test file naming: `test_*.py`.
- **Frontend:**
    - Use `vitest`.
    - Test file location: `frontend/src/__tests__/`.
    - Test file naming: `*.test.ts[x]`.
- [Source: `docs/architecture/coding-standards.md`]

## Change Log
| Date | Version | Description | Author |
|---|---|---|---|
| 2025-09-21 | 0.3 | QA concerns addressed and approved for development | Sarah (Product Owner) |
| 2025-09-21 | 0.2 | Story approved after PO review | Sarah (Product Owner) |
| 2025-09-21 | 0.1 | Initial draft created | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
{{agent_model_name_version}}
### Debug Log References
### Completion Notes List
### File List

## QA Results

### Gate Status

Gate: PASS â†’ docs/qa/gates/4.2-sprint-lifecycle-management.yml
